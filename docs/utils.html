<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 3 Utilisation de la bibliothèque | Memoire de mise en situation professionnel — Création d’une bibliothèque PHP</title>
  <meta name="description" content="Mémoire du projet de mise en situation professionnelle sur la création d’une bibliothèque PHP" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 3 Utilisation de la bibliothèque | Memoire de mise en situation professionnel — Création d’une bibliothèque PHP" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://djuhnix.github.io/memo-msp/" />
  <meta property="og:image" content="https://djuhnix.github.io/memo-msp/assets/img/undraw_developer_activity.png" />
  <meta property="og:description" content="Mémoire du projet de mise en situation professionnelle sur la création d’une bibliothèque PHP" />
  <meta name="github-repo" content="djuhnix/memo-msp" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 3 Utilisation de la bibliothèque | Memoire de mise en situation professionnel — Création d’une bibliothèque PHP" />
  
  <meta name="twitter:description" content="Mémoire du projet de mise en situation professionnelle sur la création d’une bibliothèque PHP" />
  <meta name="twitter:image" content="https://djuhnix.github.io/memo-msp/assets/img/undraw_developer_activity.png" />

<meta name="author" content="Germain Jr. OLEA-OYOUGOU" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/img/mortarboard.png" type="image/x-icon" />
<link rel="prev" href="dev.html"/>
<link rel="next" href="res.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/css/style.css" type="text/css" />
<link rel="stylesheet" href="assets/css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mémoire de mise en situation professionnelle</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Avant-propos</a></li>
<li class="chapter" data-level="" data-path="remerciements.html"><a href="remerciements.html"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="résumé.html"><a href="résumé.html"><i class="fa fa-check"></i>Résumé</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="context.html"><a href="context.html"><i class="fa fa-check"></i><b>1</b> Contexte</a><ul>
<li class="chapter" data-level="1.1" data-path="context.html"><a href="context.html#mise-en-situation-professionnelle"><i class="fa fa-check"></i><b>1.1</b> Mise en situation professionnelle</a><ul>
<li class="chapter" data-level="1.1.1" data-path="context.html"><a href="context.html#le-stage-en-dut-informatique"><i class="fa fa-check"></i><b>1.1.1</b> Le stage en DUT Informatique</a></li>
<li class="chapter" data-level="1.1.2" data-path="context.html"><a href="context.html#annulation-de-stage"><i class="fa fa-check"></i><b>1.1.2</b> Annulation de stage</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="context.html"><a href="context.html#pourquoi-faire-une-bibliothèque-en-php"><i class="fa fa-check"></i><b>1.2</b> Pourquoi faire une bibliothèque en PHP</a><ul>
<li class="chapter" data-level="1.2.1" data-path="context.html"><a href="context.html#larrière-plan"><i class="fa fa-check"></i><b>1.2.1</b> L’arrière-plan</a></li>
<li class="chapter" data-level="1.2.2" data-path="context.html"><a href="context.html#le-problème-avec-php"><i class="fa fa-check"></i><b>1.2.2</b> Le problème avec PHP</a></li>
<li class="chapter" data-level="1.2.3" data-path="context.html"><a href="context.html#définition-de-lobjectif"><i class="fa fa-check"></i><b>1.2.3</b> Définition de l’objectif</a></li>
<li class="chapter" data-level="1.2.4" data-path="context.html"><a href="context.html#la-pertinence-du-projets"><i class="fa fa-check"></i><b>1.2.4</b> La pertinence du projets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dev.html"><a href="dev.html"><i class="fa fa-check"></i><b>2</b> Développement de la bibliothèque</a><ul>
<li class="chapter" data-level="2.1" data-path="dev.html"><a href="dev.html#programme-de-la-mise-en-situation-professionnelle."><i class="fa fa-check"></i><b>2.1</b> Programme de la mise en situation professionnelle.</a><ul>
<li class="chapter" data-level="2.1.1" data-path="dev.html"><a href="dev.html#organisation"><i class="fa fa-check"></i><b>2.1.1</b> Organisation</a></li>
<li class="chapter" data-level="2.1.2" data-path="dev.html"><a href="dev.html#impression-sur-le-télétravail"><i class="fa fa-check"></i><b>2.1.2</b> Impression sur le télétravail</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="dev.html"><a href="dev.html#pre-requis"><i class="fa fa-check"></i><b>2.2</b> Pré-requis avant le développement de la bibliothèque</a><ul>
<li class="chapter" data-level="2.2.1" data-path="dev.html"><a href="dev.html#php-ffi"><i class="fa fa-check"></i><b>2.2.1</b> PHP FFI</a></li>
<li class="chapter" data-level="2.2.2" data-path="dev.html"><a href="dev.html#csfml-et-sfml"><i class="fa fa-check"></i><b>2.2.2</b> CSFML et SFML</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="dev.html"><a href="dev.html#conception"><i class="fa fa-check"></i><b>2.3</b> Conception</a><ul>
<li class="chapter" data-level="2.3.1" data-path="dev.html"><a href="dev.html#ma-première-classe-abstractffi"><i class="fa fa-check"></i><b>2.3.1</b> Ma première classe AbstractFFI</a></li>
<li class="chapter" data-level="2.3.2" data-path="dev.html"><a href="dev.html#architecture-globale"><i class="fa fa-check"></i><b>2.3.2</b> Architecture globale</a></li>
<li class="chapter" data-level="2.3.3" data-path="dev.html"><a href="dev.html#exemple-de-la-classe-window"><i class="fa fa-check"></i><b>2.3.3</b> Exemple de la classe Window</a></li>
<li class="chapter" data-level="2.3.4" data-path="dev.html"><a href="dev.html#diagramme-de-classes"><i class="fa fa-check"></i><b>2.3.4</b> Diagramme de classes</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="dev.html"><a href="dev.html#implémentation-de-la-bibliothèque"><i class="fa fa-check"></i><b>2.4</b> Implémentation de la bibliothèque</a><ul>
<li class="chapter" data-level="2.4.1" data-path="dev.html"><a href="dev.html#lordre-dimplémentation"><i class="fa fa-check"></i><b>2.4.1</b> L’ordre d’implémentation</a></li>
<li class="chapter" data-level="2.4.2" data-path="dev.html"><a href="dev.html#erreurs-de-conception"><i class="fa fa-check"></i><b>2.4.2</b> Erreurs de conception</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="dev.html"><a href="dev.html#distribution-de-la-bibliothèque"><i class="fa fa-check"></i><b>2.5</b> Distribution de la bibliothèque</a><ul>
<li class="chapter" data-level="2.5.1" data-path="dev.html"><a href="dev.html#un-gestionnaire-de-paquets-composer"><i class="fa fa-check"></i><b>2.5.1</b> Un gestionnaire de paquets : composer</a></li>
<li class="chapter" data-level="2.5.2" data-path="dev.html"><a href="dev.html#install-composer"><i class="fa fa-check"></i><b>2.5.2</b> Installation de composer</a></li>
<li class="chapter" data-level="2.5.3" data-path="dev.html"><a href="dev.html#publication-de-bibliothèque-avec-composer-et-packagist"><i class="fa fa-check"></i><b>2.5.3</b> Publication de bibliothèque avec composer et packagist</a></li>
<li class="chapter" data-level="2.5.4" data-path="dev.html"><a href="dev.html#maintenabilité"><i class="fa fa-check"></i><b>2.5.4</b> Maintenabilité</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="dev.html"><a href="dev.html#tableau-récapitulatif"><i class="fa fa-check"></i><b>2.6</b> Tableau récapitulatif</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="utils.html"><a href="utils.html"><i class="fa fa-check"></i><b>3</b> Utilisation de la bibliothèque</a><ul>
<li class="chapter" data-level="3.1" data-path="utils.html"><a href="utils.html#utils-pre-requis"><i class="fa fa-check"></i><b>3.1</b> Pré-requis à l’utilisation</a><ul>
<li class="chapter" data-level="3.1.1" data-path="utils.html"><a href="utils.html#préchargement-ffi-et-header-csfml"><i class="fa fa-check"></i><b>3.1.1</b> Préchargement FFI et header CSFML</a></li>
<li class="chapter" data-level="3.1.2" data-path="utils.html"><a href="utils.html#installation-dans-un-nouveau-projet"><i class="fa fa-check"></i><b>3.1.2</b> Installation dans un nouveau projet</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="utils.html"><a href="utils.html#exemple-dutilisation-et-documentations"><i class="fa fa-check"></i><b>3.2</b> Exemple d’utilisation et documentations</a><ul>
<li class="chapter" data-level="3.2.1" data-path="utils.html"><a href="utils.html#utilisation"><i class="fa fa-check"></i><b>3.2.1</b> Utilisation</a></li>
<li class="chapter" data-level="3.2.2" data-path="utils.html"><a href="utils.html#documentation"><i class="fa fa-check"></i><b>3.2.2</b> Documentation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="res.html"><a href="res.html"><i class="fa fa-check"></i><b>4</b> Résultat</a><ul>
<li class="chapter" data-level="4.1" data-path="res.html"><a href="res.html#finalité-de-la-bibliothèque"><i class="fa fa-check"></i><b>4.1</b> Finalité de la bibliothèque</a></li>
<li class="chapter" data-level="4.2" data-path="res.html"><a href="res.html#bilan-de-la-mise-en-situation-professionnelle"><i class="fa fa-check"></i><b>4.2</b> Bilan de la mise en situation professionnelle</a></li>
<li class="chapter" data-level="4.3" data-path="res.html"><a href="res.html#ressenti-personnel"><i class="fa fa-check"></i><b>4.3</b> Ressenti personnel</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="liste-des-abbreviations.html"><a href="liste-des-abbreviations.html"><i class="fa fa-check"></i>Liste des Abbreviations</a></li>
<li class="chapter" data-level="" data-path="références-et-bibliographie.html"><a href="références-et-bibliographie.html"><i class="fa fa-check"></i>Références et bibliographie</a></li>
<li class="appendix"><span><b>Annexes</b></span></li>
<li class="chapter" data-level="A" data-path="trello.html"><a href="trello.html"><i class="fa fa-check"></i><b>A</b> Trello</a><ul>
<li class="chapter" data-level="A.1" data-path="trello.html"><a href="trello.html#tableau-trello-au-début-du-projet"><i class="fa fa-check"></i><b>A.1</b> Tableau trello au début du projet</a></li>
<li class="chapter" data-level="A.2" data-path="trello.html"><a href="trello.html#tableau-trello-du-mémoire"><i class="fa fa-check"></i><b>A.2</b> Tableau trello du mémoire</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="documentations.html"><a href="documentations.html"><i class="fa fa-check"></i><b>B</b> Documentations</a><ul>
<li class="chapter" data-level="B.1" data-path="documentations.html"><a href="documentations.html#extrait-de-documentation-1"><i class="fa fa-check"></i><b>B.1</b> Extrait de Documentation 1</a></li>
<li class="chapter" data-level="B.2" data-path="documentations.html"><a href="documentations.html#extrait-de-documentation-2"><i class="fa fa-check"></i><b>B.2</b> Extrait de Documentation 2</a></li>
<li class="chapter" data-level="B.3" data-path="documentations.html"><a href="documentations.html#extrait-de-documentation-textuelles"><i class="fa fa-check"></i><b>B.3</b> Extrait de documentation textuelles</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
<li><a href="https://www.flaticon.com/" title="Flaticon">Icons from Flaticon</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Memoire de mise en situation professionnel — Création d’une bibliothèque PHP</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="utils" class="section level1">
<h1><span class="header-section-number">Chapitre 3</span> Utilisation de la bibliothèque</h1>
<div id="utils-pre-requis" class="section level2">
<h2><span class="header-section-number">3.1</span> Pré-requis à l’utilisation</h2>
<p>Nous avons vu dans le <a href="dev.html#pre-requis">2.2</a> que la bibliothèque développée comportait certaines dépendances résumé dans le <a href="dev.html#tab:recap-dep">2.2</a>, PHP FFI et CSFML. Après les avoir installées il reste un minimum de configuration pour pouvoir parfaitement exécuter votre premier script.</p>
<div id="préchargement-ffi-et-header-csfml" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Préchargement FFI et header CSFML</h3>
<p>La bibliothèque utilise la fonctionnalité de préchargement de PHP pour précharger les header CSFML nécessaire pour charger et utiliser cette dernière en PHP. Il s’agit donc de modifier certaines variables de configuration de <code>php.ini</code> pour convenir à nos besoins.
<em>Les instructions données seront pour linux, il est possible que la procédure change sur windows</em></p>
<div id="activation-de-ffi" class="section level4">
<h4><span class="header-section-number">3.1.1.1</span> Activation de FFI :</h4>
<p>Il faut s’assurer que FFI est en mode <code>preload</code> et est bien activé</p>
<ol style="list-style-type: decimal">
<li><p>dans le <code>php.ini</code> il faut que cette ligne soit présente <code>ffi.enable=&quot;preload&quot;</code></p></li>
<li><p>on peut vérifier la bonne activation de FFI avec la commande <code>php -m | grep FFI</code> qui doit afficher <code>FFI</code></p></li>
<li><p>activer <strong>opcache</strong> en ligne de commande en modifiant la valeur du paramètre <code>opcache.enable_cli</code> à <code>true</code>.</p></li>
</ol>
</div>
<div id="mettre-en-place-le-préchargement" class="section level4">
<h4><span class="header-section-number">3.1.1.2</span> Mettre en place le préchargement :</h4>
<p>Les fichiers header (extension en <code>.h</code>) à précharger sont dans le dossier <code>preloading</code> du dépot de la bibliothèque. Les deux premières ligne de chaque fichiers définissent :</p>
<ul>
<li>l’espace de définition utilisé pour charger la bibliothèque C en PHP, <strong>à ne pas modifier</strong></li>
<li>le chemin <em>absolu</em> vers le fichier binaire de la bibliothèque à charger, CSFML pour notre cas.
<ul>
<li>Il faut bien s’assurer que ce chemin est le bon pour réussir le chargement de la bibliothèque avec FFI.
On peut vérifier cela avec la commande <code>locate</code>. Par exemple pour le module Graphics de CSFML il faut exécuter la commande <code>locate libcsfml-graphics.so</code>.</li>
<li><strong>Attention !</strong> si <em>SFML</em> n’est pas installé avec <em>CSFML</em> la bibliothèque ne pourra pas se charger.</li>
</ul></li>
</ul>
<p>Le chemin absolu vers le dossier contenant ces fichiers doit être renseigné dans la variable <code>ffi.preload</code> du fichier de configuration de PHP en <strong>ligne de commande</strong>, sur ma machine son chemins est <code>/etc/php/7.4/cli/php.ini</code>.
Ce chemin doit ensuite être suffixé de <code>*.h</code> pour préciser que nous voulons tous les fichiers d’extension <code>.h</code> situé dans ce dossier.</p>
<ul>
<li>Par exemple si le chemin vers le dossier <code>preloading</code> du dépôt est <code>/home/user/phpml/preloading/</code> la nouvelle valeur de la variable sera :
<code>ffi.preload=&quot;/home/user/phpml/preloading/*.h&quot;</code></li>
</ul>
<p>Si tout s’est bien passé, avec cette nouvelle configuration on devrait être capable d’exécuter un script de test du dépôt sans erreurs dès qu’on l’aura installé dans un nouveau projet avec composer.</p>
</div>
</div>
<div id="installation-dans-un-nouveau-projet" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Installation dans un nouveau projet</h3>
<p>Partant du contexte que vous commencez un nouveau projet appelé <em>nice-stuff</em> et que vous vouliez y intégrer cette bibliothèque, les étapes que vous aurez à réaliser doivent comprendre :</p>
<ul>
<li>la création du dossier <code>nice_stuff</code></li>
<li>l’initialisation de votre fichier <code>composer.json</code> avec <code>composer init</code>, après l’avoir préalablement installé <a href="dev.html#install-composer">2.5.2</a></li>
<li>l’ajout de la bibliothèque <strong>PHPML</strong> en tant que dépendance à votre projet : <code>composer require djuhnix/phpml</code></li>
<li>il est important de noter que vous aurez besoin de la fonction d’autochargement fournie par composer :
<ul>
<li>il vous suffit de mettre au début de votre script la ligne ajoutant le fichier <code>vendor/autoload.php</code>. Cette ligne pourrait ressembler à <code>require_once(&quot;vendor/autoload.php&quot;)</code> mais veillez à ce que le chemin passé à la fonction soit relatif à l’emplacement de votre script.</li>
</ul></li>
</ul>
<p>A présent vous êtes prêt à utiliser la bibliothèque PHPML dans votre projet, composer s’occupera de charger les différentes classes que vous appellerez.</p>
</div>
</div>
<div id="exemple-dutilisation-et-documentations" class="section level2">
<h2><span class="header-section-number">3.2</span> Exemple d’utilisation et documentations</h2>
<div id="utilisation" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Utilisation</h3>
<p>Vous pouvez trouver des exemples d’utilisation de la bibliothèque dans le dossier <code>tests/functionnal</code> du dépôt git. Mais voici comment réaliser certaines tâches avec PHPML.</p>
<div id="comment-ouvrir-une-fenêtre" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> Comment ouvrir une fenêtre</h4>
<p>Il deux façons d’ouvrir une fenêtre, la première consiste à utiliser la classe de base <code>Window</code> et gérer par sois même les boucles qui permettent de garder la fenêtre ouverte et de gérer les événements, notamment la fermeture de la fenêtre pour éviter de démarrer une boucle infini.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">$window</span> = <span class="kw">new</span> Window<span class="ot">(</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    <span class="kw">new</span> VideoMode<span class="ot">(</span><span class="dv">400</span><span class="ot">,</span> <span class="dv">400</span><span class="ot">),</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="st">&#39;Test Window Opening&#39;</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="ot">);</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw">$event</span> = <span class="kw">new</span> Event<span class="ot">();</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">//Début de la boucle (tant que la fenêtre est ouverte)</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw">while</span> <span class="ot">(</span><span class="kw">$window</span>-&gt;isOpen<span class="ot">())</span> {</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    <span class="co">// Gestion des événements</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">    <span class="kw">while</span> <span class="ot">(</span><span class="kw">$window</span>-&gt;pollEvent<span class="ot">(</span><span class="kw">$event</span>-&gt;toCData<span class="ot">()))</span> {</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">        <span class="co">// Ferme la fenêtre si l&#39;événement &#39;closed&#39; est enregistré</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">        <span class="kw">if</span> <span class="ot">(</span><span class="kw">$event</span>-&gt;<span class="fu">getType</span><span class="ot">()</span>-&gt;getValue<span class="ot">()</span> == EventType::<span class="kw">CLOSED</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">            <span class="kw">$window</span>-&gt;close<span class="ot">();</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">        }</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb6-18" data-line-number="18">    <span class="co">// DESSINER ICI</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb6-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb6-21" data-line-number="21">    <span class="co">// Nettoyage de l&#39;écran de la fenêtre et affichage</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    <span class="kw">$window</span>-&gt;clear<span class="ot">(</span><span class="kw">$window</span>-&gt;getBackgroundColor<span class="ot">());</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23">    </a>
<a class="sourceLine" id="cb6-24" data-line-number="24">    <span class="co">// rafraîchissement et affichage des dessins s&#39;il y en a</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25">    <span class="kw">$window</span>-&gt;display<span class="ot">();</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26">}</a></code></pre></div>
<p>La création d’une instance de la classe <code>Window</code> nécessite obligatoirement de définir un mode de rendu qui contient également la taille de la fenêtre.
Pour simplifier, la création de la fenêtre j’ai pris la décision de ne pas permettre la surcharge du mode de rendu vidéo et j’utilise celui de l’ordinateur par défaut, généralement de 32 bits par pixel.</p>
<p>Malgré cela, cette procédure restant fastidieuse à réaliser à chacun de ses scripts j’ai pensé à réaliser une autre classe <code>ExtendedWindow</code> héritant de la classe <code>Window</code> et qui étend ou plutôt facilite l’utilisation des fonctionnalités de cette dernière.</p>
<p>Désormais ouvrir une fenêtre revient à écrire</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">$window</span> = <span class="kw">new</span> ExtendedWindow<span class="ot">(</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    <span class="kw">new</span> VideoMode<span class="ot">(</span><span class="dv">800</span><span class="ot">,</span> <span class="dv">600</span><span class="ot">)</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="ot">);</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">$window</span>-&gt;run<span class="ot">(</span><span class="kw">new</span> Event<span class="ot">());</span></a></code></pre></div>
<p>Comme le dit la documentation, la méthode <code>run()</code> de la classe <code>Window</code></p>
<blockquote>
<p>Lance la boucle principale de la fenêtre et l’ouvre dans le même temps.</p>
</blockquote>
<p>En plus de cela elle gère également la boucle d’événement qui s’occupe de la fermeture de la fenêtre, s’occupe de dessiner à chaque rafraîchissement les objets qui lui sont attachés et possède bien plus d’atouts que nous détaillerons plus tard.
Cette méthode facilite l’utilisation de bibliothèque à un point considérable car elle permet de s’abstraire des tâches répétitives lié à la création d’une fenêtre dans les bibliothèques graphiques classiques, c’est également la pierre angulaire de la librairie parce que c’est par elle que commence toutes activités que l’on voudrait réaliser avec la bibliothèque, comme dessiner des formes.</p>
</div>
<div id="comment-dessiner" class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> Comment dessiner</h4>
<p>Pour dessiner sur une fenêtre il n’y a rien de plus simple que l’appelle à la méthode <code>draw()</code> de la classe <code>Window</code> qui prend en paramètre un objet “dessinable” préalablement initialisé (de préférence à l’extérieur de la boucle) et l’affiche sur la fenêtre actuelle.</p>
<p>Après avoir ouvert notre fenêtre, en supposant qu’on utilise la première méthode qu’offre notre bibliothèque, il faudrait écrire dans la partie réserver aux dessins (mise en évidence plus haut) :</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">$window</span>-&gt;draw<span class="ot">(</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">            <span class="kw">new</span> RectangleShape<span class="ot">(</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                <span class="ot">[</span><span class="dv">400</span><span class="ot">,</span> <span class="dv">200</span><span class="ot">],</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">                <span class="ot">[</span><span class="dv">100</span><span class="ot">,</span> <span class="dv">200</span><span class="ot">],</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">                <span class="kw">$blue</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">            <span class="ot">)</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">        <span class="ot">);</span></a></code></pre></div>
<p>Cependant faire cela est une mauvaise pratique et il serait préférable de créer ses formes avant le lancement de la boucle de la fenêtre, cela empêcherait l’inutile création de la même forme tout au long de la boucle qui maintient la fenêtre ouverte.</p>
<p>Cela reste valable même si l’on utilise la seconde possibilité d’ouverture de fenêtre qu’est la méthode <code>run()</code> de la <code>ExtendedWindow</code>. Pour revenir sur cette méthode, il faut savoir qu’elle prend en paramètre en plus de la variable d’événements, deux fonctions qui sont respectivement utilisé pour la gestion personnalisée d’événements par l’utilisateur et la réalisation de dessins sur la fenêtre, s’il n’y a que cette dernière option qui nous intéresse on peut toujours passé null à la fonction <code>run()</code> à la place de la fonction de gestion d’événements. Il est vrai que cette façon de faire nécessite de connaître le concept de fonction anonyme (closure) qui relève de l’algorithmie légèrement avancé pour un débutant mais dès qu’on sait comment l’utiliser le reste n’est que de simples détails théoriques.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">$text</span> = <span class="kw">new</span> Text<span class="ot">(</span><span class="st">&quot;Hello&quot;</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">$text</span>-&gt;setFillColor<span class="ot">(</span><span class="kw">$blue</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">$text</span>-&gt;setPosition<span class="ot">([</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">]);</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">$text</span>-&gt;setCharacterSize<span class="ot">(</span><span class="dv">50</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw">$window</span>-&gt;run<span class="ot">(</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="kw">new</span> Event<span class="ot">(),</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="kw">null</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    <span class="kw">function</span> <span class="ot">()</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$text</span><span class="ot">,</span> <span class="kw">$window</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">        <span class="kw">$window</span>-&gt;draw<span class="ot">(</span><span class="kw">$text</span><span class="ot">);</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    }</a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="ot">);</span></a></code></pre></div>
<p>Le mot clé use est là pour dire que nous voulons utiliser ces variables pré-définie à l’interieur de notre fonction anonyme, sinon PHP ne sait pas que ces variables ont bien été déclaré et initialisé. Notre fonction anonyme peut ne pas être si anonyme qu’on peut le croire car on peut lui donner un nom, l’enregistrer dans une variable et passer cette dernière dans à la méthode <code>run()</code> plus tard dans notre script.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">function</span> dessine<span class="ot">()</span> {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">...</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">$maFonction</span> = <span class="st">&#39;dessine&#39;</span><span class="ot">;</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">//ou</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw">$maFonction</span> = <span class="kw">function</span> <span class="ot">()</span> {</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">...</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="kw">$window</span>-&gt;run<span class="ot">(</span><span class="kw">new</span> Event<span class="ot">(),</span> <span class="kw">null</span><span class="ot">,</span> <span class="kw">$maFonction</span><span class="ot">);</span></a></code></pre></div>
<p>Cependant il faut prendre en compte le fait que si l’on utiliser des variables mise à jour dynamiquement par la bibliothèque comme les événements cette méthode est à proscrire.</p>
</div>
<div id="comment-garder-les-modifications-appliquées-à-ses-objets" class="section level4">
<h4><span class="header-section-number">3.2.1.3</span> Comment garder les modifications appliquées à ses objets</h4>
<p>Par défaut la bibliothèque n’enregistre pas toutes les modifications que vous appliquer à vos formes et autres objets dessinables parce qu’ils ne sont pas attachés à la fenêtre. Pour ce faire il faut utiliser la méthode <code>addToDrawingList()</code> qui comme son nom l’indique ajoute un objet identifié par une clé à la liste des éléments à dessiner qui seront enregistrés avec les données de la fenêtre et mis à jour à toutes futures modifications.
L’objet enregistré peut toujours être retrouvé grâce à son identifiant et modifié si besoin.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">$window</span>-&gt;addToDrawingList<span class="ot">(</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">    <span class="st">&#39;rectangle&#39;</span><span class="ot">,</span> <span class="co">// la clé de l&#39;objet</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    <span class="kw">new</span> RectangleShape<span class="ot">(</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">        <span class="ot">[</span><span class="dv">400</span><span class="ot">,</span> <span class="dv">200</span><span class="ot">],</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">        <span class="ot">[</span><span class="dv">100</span><span class="ot">,</span> <span class="dv">200</span><span class="ot">],</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">        <span class="kw">new</span> Color<span class="ot">(</span>Color::<span class="kw">BLUE</span><span class="ot">)</span> <span class="co">// définition de la couleur de fond en bleue</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    <span class="ot">)</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="ot">);</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="kw">$window</span>-&gt;run<span class="ot">(</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    <span class="kw">new</span> Event<span class="ot">(),</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">    <span class="kw">null</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    <span class="kw">function</span> <span class="ot">()</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$red</span><span class="ot">,</span> <span class="kw">$window</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">        <span class="kw">$window</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">            -&gt;getDrawingList<span class="ot">()</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">            -&gt;getObject<span class="ot">(</span><span class="st">&#39;rectangle&#39;</span><span class="ot">)</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">            -&gt;setFillColor<span class="ot">(</span><span class="kw">$red</span><span class="ot">)</span> <span class="co">// Le rectangle affiché sera rouge au lieu d&#39;être bleue comme défini plus haut</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19">    <span class="ot">;</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20">    }</a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="ot">);</span></a></code></pre></div>
<p>Tout cela dans le but de faciliter l’utilisation de la bibliothèque par des débutants et surtout flexibilité de celle-ci.</p>
</div>
<div id="extra" class="section level4">
<h4><span class="header-section-number">3.2.1.4</span> Extra</h4>
<div id="créer-une-couleur" class="section level5">
<h5><span class="header-section-number">3.2.1.4.1</span> Créer une couleur</h5>
<p>Des couleurs sont prédéfinie dans l’énumération prévu pour. Mais pour s’en servir il faut créer une instance de couleur avec l’une de ces valeurs.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">$color</span> = <span class="kw">new</span> Color<span class="ot">(</span>Color::<span class="kw">RED</span><span class="ot">)</span> <span class="co">// équivaut à Color::DYNAMIC()</span></a></code></pre></div>
<p>Il est évidemment possible de créer des couleurs dynamique avec des valeur de couleurs primaires.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">$color</span> = <span class="ot">(</span><span class="kw">new</span> Color<span class="ot">(</span>Color::<span class="kw">DYNAMIC</span><span class="ot">))</span> <span class="co">// équivaut à Color::DYNAMIC()</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    -&gt;fromRGB<span class="ot">(</span><span class="dv">12</span><span class="ot">,</span> <span class="dv">12</span><span class="ot">,</span> <span class="dv">13</span><span class="ot">);</span></a></code></pre></div>
</div>
<div id="gérer-des-événements" class="section level5">
<h5><span class="header-section-number">3.2.1.4.2</span> Gérer des événements</h5>
<p>On ne pourrait pas parler proprement de bibliothèque graphique sans gestion des événements déclencher sur la fenêtre, voilà pourquoi l’implémentation de la gestion des événements et des entrées (clavier et souris) faisaient parties de mes priorités.</p>
<p>On a précédemment vu sur les morceaux de codes qu’on pouvait créer une instance d’événement avec</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">new</span> Event<span class="ot">()</span></a></code></pre></div>
<p>Le constructeur de cette classe ne prend rien en paramètre car tout est géré en interne pour l’utilisateur. Tout ce qu’il reste à faire pour l’utiliser c’est de vérifier qu’un certain type d’événement à bien été reçu et le traiter en tant que tel. Un exemple d’utilisation serait :</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">$event</span> = <span class="kw">new</span> Event<span class="ot">();</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">$window</span>-&gt;run<span class="ot">(</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    <span class="kw">$event</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    <span class="kw">function</span> <span class="ot">()</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$event</span><span class="ot">,</span> <span class="kw">$window</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">        <span class="kw">if</span> <span class="ot">(</span><span class="kw">$event</span>-&gt;<span class="fu">getType</span><span class="ot">()</span>-&gt;getValue<span class="ot">()</span> == EventType::<span class="kw">MOUSE_BUTTON_PRESSED</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">            <span class="co">// réaliser une action si un bouton de la souris est cliqué</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">        }</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">    }<span class="ot">,</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">    <span class="kw">function</span> <span class="ot">()</span> <span class="kw">use</span> <span class="ot">(</span><span class="kw">$event</span><span class="ot">,</span> <span class="kw">$window</span><span class="ot">)</span> {</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">       <span class="co">// faire ses dessins</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="ot">);</span></a></code></pre></div>
</div>
</div>
</div>
<div id="documentation" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Documentation</h3>
<p>Actuellement la documentation de la bibliothèque n’est pas hébergé mais elle peut être lu directement sur les sources de la bibliothèque sur le dépôt github.</p>

</div>
</div>
</div>
<script type="application/json" class="js-hypothesis-config">

{"showHighlights": false}

</script>
<script src="https://hypothes.is/embed.js" async></script>
            </section>

          </div>
        </div>
      </div>
<a href="dev.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="res.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["GERMAIN-memo-msp.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
